from neuro import llm_request

async def _handle_neurobilly(user_request: str) -> str:
    """
    Формирует промпт и отправляет запрос к LLM для преобразования естественного языка
    в стандартизированную команду бота

    Эта функция является "переводчиком" с человеческого языка на язык, понятный
    исполнителю команд `executor`

    Args:
        user_request (str): Текст запроса от пользователя, который нужно проанализировать

    Returns:
        str: Строка со стандартизированной командой (например, "пропусти" или "пауза")
    """
    system_prompt = f"""
    Ты - ИИ-анализатор для Discord бота по имени Билли. Твоя задача - проанализировать запрос пользователя и преобразовать его в одну из строго определенных команд.

    Доступные команды:
    - `поставь [название трека]` - если пользователь хочет что-то включить или послушать по запросу.
    - `поставь [ссылка]` - если пользователь хочет что-то включить или послушать по ссылке.
    - `пропусти` - если пользователь хочет пропустить текущий трек.
    - `пауза` - если пользователь хочет поставить музыку на паузу.
    - `продолжи` - если пользователь хочет возобновить воспроизведение.
    - `стоп` - если пользователь хочет полностью остановить музыку и очистить очередь.
    - `очищай нахуй` - если пользователь хочет очистить очередь, не останавливая текущий трек.
    - `ты ошибся дверью друг` - если пользователь хочет, чтобы бот вышел из канала.
    - `очередь` - если пользователь хочет посмотреть список следующих треков.
    - `убери [номер]` - если пользователь хочет удалить трек из очереди по номеру.

    ПРАВИЛА:
    1. Твой ответ должен содержать ТОЛЬКО одну команду из списка выше.
    2. Не добавляй никаких объяснений, приветствий или знаков препинания.
    3. Если команда требует аргумент (например, название трека или номер), включи его в ответ.
    4. Если запрос не соответствует ни одной из команд или является просто болтовней, ответь ровно одной фразой: `unknown_command`.

    Примеры:
    - Запрос: "следующий трек пожалуйста" -> Ответ: `пропусти`
    - Запрос: "врубай гачи ремикс работяга" -> Ответ: `поставь гачи ремикс работяга`
    - Запрос: "хватит орать" -> Ответ: `пауза`
    - Запрос: "удали третью песню" -> Ответ: `убери 3`
    - Запрос: "привет как дела" -> Ответ: `unknown_command`

    Теперь обработай следующий запрос пользователя.
    Запрос: "{user_request}"
    """

    llm_answer = await llm_request(system_prompt, 20, 1.0, 0.1)

    if llm_answer:
        return llm_answer
    else:
        return "**Billy:** Моя нейросеть сейчас on a break. Попробуй позже, slave."
